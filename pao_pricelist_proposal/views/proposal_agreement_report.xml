<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- <report id="report_proposal_agreement" model="pao.pricelist.proposal" string="Proposal Agreement" name="pao_pricelist_proposal.proposal_agreement" file="pao_pricelist_proposal.agreement" report_type="qweb-pdf" /> -->

    <record id="report_proposal_agreement" model="ir.actions.report">
        <field name="name">Proposal Agreement</field>
        <field name="model">pao.pricelist.proposal</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">pao_pricelist_proposal.proposal_agreement</field>
        <field name="report_file">pao_pricelist_proposal.proposal_agreement</field>
        <field name="print_report_name">'Proposal Agreement'</field>
        <field name="binding_model_id" ref="pao_pricelist_proposal.model_pao_pricelist_proposal"/>
        <field name="binding_type">report</field>
    </record>

    <template id="proposal_agreement">
        <t t-call="web.basic_layout">
            <t t-foreach="docs" t-as="proposal">
                <div t-attf-class="header">
                    <div class="d-flex">
                        <div class="col-2">
                            <img t-att-src="proposal.base_url" style="width:auto; height:80px" alt="Logo"/>
                        </div>
                    </div>
                </div>

                <!-- <t t-if="pricelist.pricelist_agreement_id">
                    
                    <t t-set="proposal" t-value="pricelist.pricelist_agreement_id"/> -->

                <b>Dear <t t-esc="proposal.customer_id.display_name"/>
                </b>
                <br/>
                <br/>
                <!-- Reiterating our gratitude for your trust in considering us as your third-party 
                    audit services provider in agri-food safety, we are pleased to present the 
                    proposal of preferential prices for your audits during the 2023-2024 season. -->
                <t t-esc="proposal.message_proposal_template_id.template"/>
                <br/>
                <br/>
                    You can view the preferred pricing proposal below.
                <br/>
                <br/>
                <t t-set="categories" t-value="[]"/>
                <t t-foreach="proposal.item_ids" t-as="item">
                    <t t-set="category" t-value="item.product_tmpl_id.categ_id"/>
                    <t t-if="category">
                        <t t-set="category_name" t-value="category.name"/>
                        <t t-if="not categories or category_name not in categories">
                            <t t-set="categories" t-value="categories + [category_name]"/>
                        </t>
                    </t>
                </t>

                <div class="mx-4">
                    <t t-foreach="categories" t-as="category_name">
                        <table class="table mb-4">
                            <thead>
                                <tr>
                                    <th class="text-uppercase">
                                        <t t-esc="category_name"/>
                                    </th>
                                    <th class="text-uppercase">Normal price</th>
                                    <th class="text-uppercase">Preferred price</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="proposal.item_ids.filtered(lambda item: item.product_tmpl_id.categ_id.name == category_name)" t-as="item">
                                    <t t-set="base_item" t-value="proposal.base_pricelist.item_ids.filtered(lambda base_item: base_item.product_tmpl_id.id == item.product_tmpl_id.id)[0]" t-if="proposal.base_pricelist"/>
                                    <tr>
                                        <td class="col-md-7">
                                            <t t-esc="item.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="'${:,.2f}'.format(base_item.fixed_price)" t-if="base_item"/>
                                        </td>
                                        <td>
                                            <t t-esc="'${:,.2f}'.format(item.fixed_price)"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>
                </div>

                <t t-if="proposal.proposal_terms">
                    <div class="mb-4">
                        <t t-raw="proposal.proposal_terms.terms_and_conditions" class="font-sans-serif"/>
                    </div>
                </t>

                <div style="page-break-before: always;">
                    Without further ado, we remain available for any questions or comments.
                    <br/>
                    <br/>
                    Sincerely
                    <br/>
                    <br/>
                    <p class="text-center">
                        <t t-esc="proposal.create_uid.name"/>
                    </p>
                    <br/>
                    <br/>

                    <div class="d-flex" style="margin-left: 40px !important;">
                        <div style="width: 30% !important;" class="mx-2">
                            <p class="text-center">
                                <img class="img img-responsive" style="width: 200px; heigth: auto;" t-att-src="image_data_uri(proposal.pricelist_proposal_manager_id.es_sign_signature)" t-if="proposal.pricelist_proposal_manager_id and proposal.pricelist_proposal_manager_id.es_sign_signature"/>
                            </p>
                            <p class="text-center" style="border-top: 1px solid black;">
                                <b>
                                    <t t-esc="proposal.pricelist_proposal_manager_id.name" t-if="proposal.pricelist_proposal_manager_id"/>
                                </b>
                                <br/>
                                <b>
                                    <t t-esc="proposal.pricelist_proposal_manager_id.job_title" t-if="proposal.pricelist_proposal_manager_id"/>
                                </b>
                            </p>
                        </div>
                        <div style="width: 30% !important" class="mx-2">
                            <p class="text-center">
                                <img class="img img-responsive" style="width: 200px; heigth: auto;" t-att-src="image_data_uri(proposal.create_uid.employee_id.es_sign_signature)" t-if="proposal.create_uid.employee_id"/>
                            </p>
                            <p class="text-center" style="border-top: 1px solid black;">
                                <b>
                                    <t t-esc="proposal.create_uid.name"/>
                                </b>
                                <br/>
                                <b>
                                    <t t-esc="proposal.create_uid.employee_id.job_title" t-if="proposal.create_uid.employee_id"/>
                                </b>
                            </p>
                        </div>
                        <div style="width: 30% !important" class="mx-2">
                            <p class="text-center">
                                <img class="img img-responsive" style="width: 200px; heigth: auto;" t-att-src="image_data_uri(proposal.signature)" t-if="proposal.signature"/>
                            </p>
                            <p class="text-center" style="border-top: 1px solid black;">
                                <b>
                                    <t t-esc="proposal.customer_id.display_name"/>
                                </b>
                                <br/>
                                <b>
                                    <t t-esc="proposal.origin_product_pricelist_id.name"/>
                                </b>
                            </p>
                        </div>
                    </div>
                </div>

            </t>
            <div t-attf-class="footer pt-5 mx-0 px-0 text-center" style="font-size: 13px; width: 100% !important;">
                <!-- <img src="pao_pricelist_proposal/static/src/img/footer.png" style="width:100% !important; height: auto" alt="pao_info"/> -->
                <div class="text-center" style="color: black !important;">
                    <span>
                        <b>Av Lázaro Cárdenas Número Exterior 3478 Colonia Chapalita Guadalajara Jalisco, C.P. 44500</b>
                    </span>
                    <br/>
                    <span>
                        <b>USA:</b> HQ Santa Maria, CA  •  Brandon, FL  •  <b>Mexico:</b> Guadalajara  •  Culiacán  •  Uruapan  •  
                        <b>Costa Rica:</b> San José  •  <b>Chile:</b> Viña del Mar
                    </span>
                </div>
                <div class="d-flex justify-content-center mt-2" style="background-color: black !important; padding: 15px 100px 15px 100px !important;">
                    <div class="text-center" style="width: 40% !important;color: white;">
                        <i class="fa fa-envelope" aria-hidden="true" style="color: #78c957 !important; font-size: 17px !important;"/>
                        <span class="mx-1">paomexico@primusauditingops.com</span>
                    </div>

                    <div class="text-center" style="width: 20% !important; border-right: 2px solid white; border-left: 2px solid white; color: white;">
                        <i class="fa fa-phone" aria-hidden="true" style="color: #78c957 !important; font-size: 17px !important;"/>
                        <span class="mx-1">331.981.8572</span>
                    </div>

                    <div class="text-center" style="width: 40% !important; color: white;">
                        <i class="fa fa-globe" aria-hidden="true" style="color: #78c957 !important; font-size: 17px !important;"/>
                        <span class="mx-1">primusauditingops.com</span>
                    </div>
                </div>

            </div>
        </t>
    </template>

</odoo>
