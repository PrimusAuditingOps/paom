<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="portal_my_home_expenses" name="Show Expenses" customize_show="True" inherit_id="portal.portal_my_home" priority="50">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="before">
            <t t-set="portal_service_category_enable" t-value="True"/>
        </xpath>
        <div id="portal_service_category" position="inside">
            <t t-if="request.env.user.partner_id.is_an_in_house_auditor" t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/purchase/static/src/img/rfq.svg'"/>
                <t t-set="text">Add your travel expenses</t>
                <t t-set="title">Expenses</t>
                <t t-set="url" t-value="'/my/expense_reports'"/>
                <t t-set="config_card" t-value="True"/>
            </t>
        </div>
    </template>

    <template id="portal_breadcrumbs_expense" inherit_id="portal.portal_breadcrumbs">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">

            <li t-if="page_name == 'expense_reports'" class="breadcrumb-item">Expense Reports</li>

            <t t-if="page_name == 'expense_report_form_view'">
                <li class="breadcrumb-item">
                    <a href="/my/expense_reports">Expense Reports</a>
                </li>
                <li t-if="report" class="breadcrumb-item">
                    <t t-out="report.name"/>
                </li>
            </t>

            <t t-if="page_name == 'wallet_expenses'">
                <li class="breadcrumb-item">
                    <a href="/my/expense_reports">Expense Reports</a>
                </li>
                <li class="breadcrumb-item">
                    Wallet
                </li>
            </t>

        </xpath>
    </template>

    <template id="my_expense_reports_view" name="My Expenses">
        <t t-call="portal.portal_layout">

            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Expense Reports</t>
            </t>

            <a class="btn btn-primary mb-3" href="/my/expense_reports/new">Create Expense Report</a>

            <a class="btn btn-primary mb-3" href="/my/wallet">My Wallet</a>

            <table t-if="expense_reports" class="o_list_table position-relative table table-sm o_list_table_ungrouped table-striped o_portal_my_doc_table mb-0 table-hover">
                <thead>
                    <tr class="active">
                        <th>
                            <span class='d-none d-md-inline'>Expense Report Summary</span>
                            <span class='d-block d-md-none'>Ref.</span>
                        </th>
                        <th>Purchase Order</th>
                        <th class="text-end">Total (<span t-esc="currency"></span>)
                        </th>
                        <th class="text-center">Status</th>
                        <th></th>
                    </tr>
                </thead>
                <t t-foreach="expense_reports" t-as="report">
                    <tr>
                        <td style="cursor:pointer" t-att-onclick="'window.location.href=\'/my/expense_reports/' + str(report.id) +'\''">
                            <span t-field="report.name"/>
                        </td>
                        <td style="cursor:pointer" t-att-onclick="'window.location.href=\'/my/expense_reports/' + str(report.id) +'\''">
                            <span t-field="report.purchase_order.name"/>
                        </td>
                        <td class="text-end" style="cursor:pointer" t-att-onclick="'window.location.href=\'/my/expense_reports/' + str(report.id) +'\''">
                            <span t-field="report.total_amount"/>
                        </td>
                        <td class="text-center" style="cursor:pointer" t-att-onclick="'window.location.href=\'/my/expense_reports/' + str(report.id) +'\''">
                            <span t-field="report.state"/>
                        </td>
                        <td>
                            <button class="btn btn-primary" t-if="report.state in ('draft', 'submit')" type="button" data-bs-toggle="modal" t-att-data-bs-target="'#delete_report_' + str(report.id)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"></path>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"></path>
                                </svg>
                            </button>
                        </td>
                    </tr>

                    <div class="modal fade" t-att-id="'delete_report_' + str(report.id)" tabindex="-1" aria-labelledby="delete_report_label" aria-hidden="true">
                        <div class="modal-dialog">
                            <form action="/my/expense_reports/delete" method="POST">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <input type="hidden" name="report_id" t-att-value="report.id"/>
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Delete report</h4>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                        <h6>Are you sure you want to delete this report?</h6>

                                        <button class="btn btn-danger mt-3" type="submit">Delete</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </t>

            </table>
            <div t-if="not expense_reports" class="alert alert-warning mt-4" role="alert">
                There are currently no expense reports for your account.
            </div>

            <br/>
            <br/>
            <br/>

        </t>
    </template>

    <template id="my_expenses_details_view" name="Expense Report">
        <t t-call="portal.portal_layout">

            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Expenses Report</t>
            </t>

            <div t-if="error_expense" class="alert alert-danger" role="alert">
                <t t-out="error_expense"/>
            </div>

            <form action="/my/expense_reports/save" method="POST">

                <div class="d-flex justify-content-between" style="flex-flow: wrap;">
                    <h3 class="me-3">
                        <span>Expense Report</span>
                    </h3>

                    <ul t-if="not new_report" class="mt-1 d-flex justify-content-end list-unstyled fw-bold">
                        <t t-set="option_counter" t-value="0"/>
                        <t t-foreach="stages_options" t-as="option">
                            <t t-set="option_counter" t-value="option_counter + 1"/>
                            <li t-att-class="'px-3 py-1 border border-2 text-center d-flex' + (' rounded-start' if option_counter==1 else '') + (' rounded-end' if option_counter==len(stages_options) else '') + (' text-white' if report.state==option[0] else ' text-secondary')" t-att-style="'background:' + ('#714B67' if report.state==option[0] else 'lightgray') +'; align-items: center;'">
                                <span>
                                    <t t-esc="option[1]"/>
                                </span>
                            </li>
                        </t>
                    </ul>
                </div>

                <br/>

                <button t-if="submittable or new_report" class="btn btn-primary" type="submit">Save</button>
                <button class="btn btn-primary" type="button" data-bs-toggle="modal" t-if="submittable" data-bs-target="#add_expenses">Add expenses</button>
                <button t-if="submittable" type="submit" class="btn btn-primary" formaction="/my/expense_reports/submit">Submit</button>
                <t t-if="report">
                    <button t-if="report.state in ('submit', 'cancel', 'approve')" type="submit" class="btn btn-primary" formaction="/my/expense_reports/reset">Reset to Draft</button>
                </t>

                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <input type="hidden" name="report_id" t-if="not new_report" t-att-value="report.id if report else ''"/>

                <div class="mt-3">
                    <div class="mb-3 row">
                        <label for="report_summary" class="fw-bold col-sm-2 col-form-label pt-0">Summary</label>
                        <div class="col-sm-10">
                            <input name="report_summary" class="form-control" t-att-value="report.name if report else ''" t-if="new_report or submittable" required="1"/>
                            <span name="report_summary" t-field="report.name" t-if="not new_report and not submittable"/>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="report_purchase_order" class="fw-bold col-sm-2 col-form-label pt-0" t-if="purchase_order_redirect or (report and report.purchase_order)">Purchase order</label>
                        <div class="col-sm-10">
                            <div t-att-class="'btn-group ' + ('d-none' if not purchase_order_redirect else '')">
                                <select name="report_purchase_order" t-att-class="'form-select' + (' pe-none' if new_report and purchase_order_redirect else '')" id="report_purchase_order">
                                    <option class="d-none"></option>
                                    <t t-foreach="purchase_orders_account" t-as="order">
                                        <option t-att-value="order.id" t-att-selected="(report and report.purchase_order and order.id == report.purchase_order.id) or (purchase_order_redirect and int(purchase_order_redirect) == order.id)">
                                            <t t-esc="order.name"/>
                                        </option>
                                    </t>
                                </select>
                                <a class="btn btn-secondary d-none" id="purchase_redirect" t-att-href="'/my/purchase/'+str(report.purchase_order.id) if report and report.purchase_order else '#'" role="button">➜</a>
                            </div>

                            <a t-if="not new_report and report.purchase_order" t-att-href="'/my/purchase/'+str(report.purchase_order.id)">
                                <t t-esc="report.purchase_order.name"/>
                            </a>

                            <script>
                                var purchase_field = document.getElementById('report_purchase_order');
                                if(purchase_field){
                                    purchase_field.addEventListener('change', function() {
                                        var selectedValue = this.value;
                                        link = '/my/purchase/' + selectedValue
                                        document.getElementById('purchase_redirect').setAttribute('href', link);
                                    });
                                }
                            </script>

                        </div>
                    </div>
                    <div class="mb-3 row d-none">
                        <label for="scheme" class="fw-bold col-sm-2 col-form-label pt-0">Scheme</label>
                        <div class="col-sm-2">
                            <select name="scheme" class="form-select" t-if="new_report or submittable">
                                <option class="d-none"></option>
                                <t t-foreach="schemes" t-as="scheme">
                                    <option t-att-value="scheme.id" t-att-selected="(report and report.expense_scheme_id and scheme.id == report.expense_scheme_id.id)">
                                        <t t-esc="scheme.name"/>
                                    </option>
                                </t>
                            </select>
                            <span name="scheme" t-field="report.expense_scheme_id" t-if="not new_report and not submittable"/>
                        </div>
                    </div>
                    <div class="mb-3 row" t-if="not new_report">
                        <label for="report_total" class="fw-bold col-sm-2 col-form-label pt-0">Total (<span t-esc="currency"></span>)
                        </label>
                        <div class="col-sm-10">
                            <span t-field="report.total_amount"/>
                            <!-- <input name="report_total" class="form-control" t-att-value="report.total_amount if report else '0.00'" readonly="1"/> -->
                        </div>
                    </div>
                </div>

            </form>

            <hr/>


            <t t-if="not new_report and report.expense_line_ids" t-call="portal.portal_table">
                <h3>
                    <span>Expenses</span>
                </h3>
                <thead>
                    <tr class="active">
                        <th>
                            <span class='d-none d-md-inline'>Expense Date</span>
                            <span class='d-block d-md-none'>Ref.</span>
                        </th>
                        <th class="text-center">Category</th>
                        <th class="text-end">Description</th>
                        <th class="text-end">Customer to Reinvoice</th>
                        <th class="text-end">Taxes</th>
                        <th class="text-end">Subtotal (<span t-esc="currency"></span>)
                        </th>
                        <th t-if="submittable"></th>
                    </tr>
                </thead>
                <t t-foreach="report.expense_line_ids" t-as="expense">
                    <tr>
                        <td>
                            <span t-field="expense.date" t-options="{'widget': 'date'}"/>
                        </td>
                        <td class="text-center">
                            <span t-field="expense.product_id"/>
                        </td>
                        <td>
                            <span t-field="expense.name"/>
                        </td>
                        <td class="text-center">
                            <span t-field="expense.sale_order_id"/>
                        </td>
                        <td class="text-end">
                            <span t-field="expense.tax_ids"/>
                        </td>
                        <td class="text-end">
                            <span t-field="expense.total_amount"/>
                        </td>
                        <td t-if="submittable">
                            <button class="btn btn-primary" type="button" data-bs-toggle="modal" t-att-data-bs-target="'#delete_expense_' + str(expense.id)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"></path>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"></path>
                                </svg>
                            </button>
                        </td>
                    </tr>

                    <div class="modal fade" t-att-id="'delete_expense_' + str(expense.id)" tabindex="-1" aria-labelledby="delete_expense_label" aria-hidden="true">
                        <div class="modal-dialog">
                            <form action="/my/expense/delete" method="POST">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <input type="hidden" name="expense_id" t-att-value="expense.id"/>
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Delete expense</h4>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                        <h6>Are you sure you want to remove this expense from the report?</h6>

                                        <button class="btn btn-danger mt-3" type="submit">Delete</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                </t>
            </t>

            <div t-if="not new_report and not report.expense_line_ids" class="alert alert-warning" role="alert">
                There are currently no expenses in this report.
            </div>

            <div t-if="not new_report" id="expense_sheet_communication" class="mt-4">
                <h3>Communication history</h3>
                <t t-call="portal.message_thread">
                    <t t-set="object" t-value="report"/>
                </t>
            </div>

            <br/>
            <br/>
            <br/>

            <div t-if="submittable" class="modal fade" id="add_expenses" tabindex="-1" aria-labelledby="add_expenses_label" aria-hidden="true">
                <div class="modal-dialog">
                    <form method="POST" action="/my/expense/new" enctype="multipart/form-data">
                        <input type="hidden" name="report_id" t-att-value="report.id"/>
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Add expense</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <div class="mb-3 row">
                                    <label for="description" class="fw-bold col-sm-3 col-form-label">Description</label>
                                    <div class="col-sm-9">
                                        <input name="description" class="form-control" required="1"/>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="expense_category" class="fw-bold col-sm-3 col-form-label">Category</label>
                                    <div class="col-sm-9">
                                        <select name="expense_category" class="form-select" required="1">
                                            <option class="d-none" selected="1"></option>
                                            <t t-foreach="categories" t-as="category">
                                                <option t-att-value="category.id">
                                                    <t t-esc="category.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="expense_date" class="fw-bold col-sm-3 col-form-label">Expense Date</label>
                                    <div class="col-sm-9">
                                        <input type="date" class="form-control" name="expense_date" t-att-max="today" required="1"/>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="receipt" class="fw-bold col-sm-3 col-form-label">Receipt</label>
                                    <div class="col-sm-9">
                                        <input name="receipt" type="file" class="form-control" accept=".pdf, image/*, .doc, .docx, .xml" required="1" multiple="1"/>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="total" class="fw-bold col-sm-3 col-form-label">Total</label>
                                    <div class="col-sm-6 pe-1">
                                        <input name="total" type="number" class="form-control" required="1"/>
                                    </div>
                                    <div class="col-sm-3">
                                        <select name="currency_id" class="form-select" required="1">
                                            <option class="d-none" selected="1"></option>
                                            <t t-foreach="currencies" t-as="currency">
                                                <option t-att-value="currency.id">
                                                    <t t-esc="currency.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                </div>

                                <button class="btn btn-primary" type="submit">Save</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </t>
    </template>






    <template id="my_wallet_expenses_view" name="My Wallet">
        <t t-call="portal.portal_layout">

            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Expenses</t>
            </t>

            <div t-if="error_expense" class="alert alert-danger" role="alert">
                <t t-out="error_expense"/>
            </div>

            <button class="btn btn-primary mb-3" type="button" data-bs-toggle="modal" data-bs-target="#create_expense">Create expense</button>

            <button class="btn btn-primary mb-3" type="button" data-bs-toggle="modal" data-bs-target="#add_expense_to_report">Add to expense report</button>

            <table t-if="expenses" class="o_list_table position-relative table table-sm o_list_table_ungrouped table-striped o_portal_my_doc_table mb-0 table-hover">
                <thead>
                    <tr class="active">
                        <th></th>
                        <th>
                            <span class='d-none d-md-inline'>Expense Date</span>
                        </th>
                        <th>Description</th>
                        <th>Report</th>
                        <th class="text-end">Total (<span t-esc="currency"></span>)
                        </th>
                        <th class="text-center">Status</th>
                        <th></th>
                    </tr>
                </thead>
                <t t-foreach="expenses" t-as="expense">
                    <tr>
                        <td>
                            <input class="form-check-input" name="selected_expenses" type="checkbox" t-if="expense.state == 'draft'" t-att-value="expense.id" t-att-id="'expense_' + str(expense.id)" t-att-disabled="expense.state != 'draft'"/>
                        </td>
                        <td>
                            <span t-field="expense.date"/>
                        </td>
                        <td>
                            <span t-field="expense.name"/>
                        </td>
                        <td>
                            <a t-if="expense.sheet_id" t-att-href="'/my/expense_reports/'+str(expense.sheet_id.id)">
                                <t t-esc="expense.sheet_id.name"/>
                            </a>
                        </td>
                        <td class="text-end">
                            <span t-field="expense.total_amount"/>
                        </td>
                        <td class="text-center">
                            <span t-field="expense.state"/>
                        </td>
                        <td>
                            <button class="btn btn-primary" t-if="expense.nb_attachment &lt; 1" type="button" data-bs-toggle="modal" t-att-data-bs-target="'#add_receipt_' + str(expense.id)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-receipt" viewBox="0 0 16 16">
                                    <path d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27m.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0z"/>
                                    <path d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5"/>
                                </svg>
                            </button>

                            <button class="btn btn-primary" t-if="expense.state in ('draft', 'submit')" type="button" data-bs-toggle="modal" t-att-data-bs-target="'#delete_expense_' + str(expense.id)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"></path>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"></path>
                                </svg>
                            </button>
                        </td>
                    </tr>

                    <div class="modal fade" t-att-id="'delete_expense_' + str(expense.id)" tabindex="-1" aria-labelledby="delete_expense_label" aria-hidden="true">
                        <div class="modal-dialog">
                            <form action="/my/expense/delete" method="POST">
                                <input type="hidden" name="expense_id" t-att-value="expense.id"/>
                                <input type="hidden" name="unlink" value="1"/>
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Delete expense</h4>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                        <h6>Are you sure you want to delete this expense?</h6>

                                        <button class="btn btn-danger mt-3" type="submit">Delete</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="modal fade" t-att-id="'add_receipt_' + str(expense.id)" tabindex="-1" aria-labelledby="add_receipt_label" aria-hidden="true">
                        <div class="modal-dialog">
                            <form action="/my/wallet/add_receipt_to_expense" method="POST" enctype="multipart/form-data">
                                <input type="hidden" name="expense_id" t-att-value="expense.id"/>
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Add receipt</h4>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                        <div class="mb-3 row">
                                            <label for="receipt" class="fw-bold col-sm-3 col-form-label">Receipt</label>
                                            <div class="col-sm-9">
                                                <input name="receipt" type="file" class="form-control" accept=".pdf, image/*, .doc, .docx, .xml" required="1" multiple="1"/>
                                            </div>
                                        </div>

                                        <button class="btn btn-primary mt-3" type="submit">Save</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </t>

            </table>

            <div class="modal fade" id="create_expense" tabindex="-1" aria-labelledby="create_expense_label" aria-hidden="true">
                <div class="modal-dialog">
                    <form method="POST" action="/my/wallet_expense/new" enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Create expense</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <div class="mb-3 row">
                                    <label for="description" class="fw-bold col-sm-3 col-form-label">Description</label>
                                    <div class="col-sm-9">
                                        <input name="description" class="form-control" required="1"/>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="expense_category" class="fw-bold col-sm-3 col-form-label">Category</label>
                                    <div class="col-sm-9">
                                        <select name="expense_category" class="form-select" required="1">
                                            <option class="d-none" selected="1"></option>
                                            <t t-foreach="categories" t-as="category">
                                                <option t-att-value="category.id">
                                                    <t t-esc="category.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="expense_date" class="fw-bold col-sm-3 col-form-label">Expense Date</label>
                                    <div class="col-sm-9">
                                        <input type="date" class="form-control" name="expense_date" t-att-max="today" required="1"/>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="receipt" class="fw-bold col-sm-3 col-form-label">Receipt</label>
                                    <div class="col-sm-9">
                                        <input name="receipt" type="file" class="form-control" accept=".pdf, image/*, .doc, .docx, .xml" required="1" multiple="1"/>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="total" class="fw-bold col-sm-3 col-form-label">Total</label>
                                    <div class="col-sm-6 pe-1">
                                        <input name="total" type="number" class="form-control" required="1"/>
                                    </div>
                                    <div class="col-sm-3">
                                        <select name="currency_id" class="form-select" required="1">
                                            <option class="d-none" selected="1"></option>
                                            <t t-foreach="currencies" t-as="currency">
                                                <option t-att-value="currency.id">
                                                    <t t-esc="currency.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                </div>

                                <button class="btn btn-primary" type="submit">Save</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="modal fade" id="add_expense_to_report" tabindex="-1" aria-labelledby="add_expense_to_report_label" aria-hidden="true">
                <div class="modal-dialog">
                    <form method="POST" id="add_expenses_to_report_form" action="/my/wallet/add_expenses_to_report">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Add expenses to report</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <select name="report_id" class="form-select" required="1">
                                    <option class="d-none"></option>
                                    <t t-foreach="reports" t-as="report">
                                        <option t-att-value="report.id">
                                            <t t-esc="report.name"/>
                                        </option>
                                    </t>
                                </select>

                                <button class="btn btn-primary mt-3" type="submit">Add</button>
                            </div>
                        </div>
                    </form>

                    <script>
                        document.getElementById('add_expenses_to_report_form').addEventListener('submit', function() {
                            event.preventDefault();

                            var form = this;
                            var checkboxes = document.querySelectorAll('input[name="selected_expenses"]:checked');

                            // Iterate through the selected checkboxes
                            checkboxes.forEach(function(checkbox) {
                                // Create a hidden input element for each selected checkbox
                                var hiddenInput = document.createElement('input');
                                hiddenInput.type = 'hidden';
                                hiddenInput.name = 'selected_expenses';
                                hiddenInput.value = checkbox.value;

                                // Append the hidden input to the form
                                form.appendChild(hiddenInput);
                            });

                            // Submit the form
                            form.submit();
                        });
                    </script>

                </div>
            </div>


            <div t-if="not expenses" class="alert alert-warning mt-4" role="alert">
                There are currently no expenses for your account.
            </div>

            <br/>
            <br/>
            <br/>

        </t>
    </template>

</odoo>